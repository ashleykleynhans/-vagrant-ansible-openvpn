# {{ ansible_managed }}

port {{ openvpn_port }}
proto {{ openvpn_proto }}
dev tun

ca {{ openvpn_cert_path }}/ca.crt
cert {{ openvpn_server_path }}/server.crt
key {{ openvpn_server_path }}/server.key
dh {{ openvpn_server_path }}/dh.pem
tls-auth {{ openvpn_server_path }}/ta.key 0
tls-server
auth {{ openvpn_auth | default('SHA256') }}
cipher {{ openvpn_cipher }}
tls-version-min 1.2
tls-cipher TLS-ECDHE-ECDSA-WITH-AES-256-GCM-SHA384:TLS-ECDHE-RSA-WITH-AES-256-GCM-SHA384:TLS-DHE-RSA-WITH-AES-256-GCM-SHA384:TLS-ECDHE-ECDSA-WITH-AES-256-CBC-SHA384:TLS-ECDHE-RSA-WITH-AES-256-CBC-SHA384:TLS-DHE-RSA-WITH-AES-256-CBC-SHA256

server {{ openvpn_network }} {{ openvpn_netmask }}
ifconfig-pool-persist persist.txt

push "redirect-gateway def1 bypass-dhcp"
push "dhcp-option DNS 1.0.0.1"
push "dhcp-option DNS 1.1.1.1"
push "dhcp-option DNS 8.8.8.8"
push "dhcp-option DNS 8.8.4.4"
keepalive {{ openvpn_keepalive_ping }} {{ openvpn_keepalive_timeout }}
compress lzo
persist-key
persist-tun
user nobody
group nogroup

status status-openvpn.log
status-version 2
log-append /var/log/openvpn/openvpn.log
verb 3

script-security 1

{% if openvpn_script_up is defined %}
up {{ openvpn_base_path }}/up.sh
{% endif %}
{% if openvpn_script_down is defined %}
down {{ openvpn_base_path }}/down.sh
{% endif %}

{% if openvpn_script_client_connect is defined %}
client-connect {{ openvpn_base_path }}/client_connect.sh
{% endif %}
{% if openvpn_script_client_disconnect is defined %}
client-disconnect {{ openvpn_base_path }}/client_disconnect.sh
{% endif %}

{% if openvpn_proto == 'udp' %}
explicit-exit-notify 1
{% else %}
explicit-exit-notify 0
{% endif %}
